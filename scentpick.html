<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒæƒ…é¦™æ°›</title>
    <!-- å¼•å…¥Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥Iconå›¾æ ‡åº“ (ç”¨äºæ”¶è—ã€åˆ†äº«ç­‰) -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    
    <style>
        /* ... (æ ·å¼ä¸ä¹‹å‰ç›¸åŒ) ... */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #FFFBF5;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- ä¸»å®¹å™¨ (ç§»åŠ¨ä¼˜å…ˆ, æœ€å¤§å®½åº¦) -->
    <div class="w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden" style="box-shadow: 0 20px 60px -10px rgba(139, 92, 246, 0.2);">
        
        <!-- 1. å¿ƒæƒ…é€‰æ‹©åŒºåŸŸ -->
        <header class="p-6">
            <h1 class="text-2xl font-bold text-gray-800 text-center mb-6">ä½ ç°åœ¨çš„å¿ƒæƒ…æ˜¯ï¼Ÿ</h1>
            <!-- æ›´æ–°ä¸º 3x2 å¸ƒå±€ -->
            <div class="grid grid-cols-3 gap-4 justify-items-center">
                <!-- å¿ƒæƒ…æŒ‰é’® -->
                <button class="mood-btn p-4 rounded-full transition-all duration-300 focus:outline-none" data-mood="happy">
                    <span class="text-3xl">ğŸ˜„</span>
                </button>
                <button class="mood-btn p-4 rounded-full transition-all duration-300 focus:outline-none" data-mood="relaxed">
                    <span class="text-3xl">ğŸ˜Œ</span>
                </button>
                <button class="mood-btn p-4 rounded-full transition-all duration-300 focus:outline-none" data-mood="focused">
                    <span class="text-3xl">ğŸ§‘â€ğŸ’»</span>
                </button>
                <button class="mood-btn p-4 rounded-full transition-all duration-300 focus:outline-none" data-mood="sleepy">
                    <span class="text-3xl">ğŸ˜´</span>
                </button>
                <!-- æ–°å¢å¿ƒæƒ… -->
                <button class="mood-btn p-4 rounded-full transition-all duration-300 focus:outline-none" data-mood="dejected">
                    <span class="text-3xl">ğŸ˜</span>
                </button>
                <button class="mood-btn p-4 rounded-full transition-all duration-300 focus:outline-none" data-mood="angry">
                    <span class="text-3xl">ğŸ˜ </span>
                </button>
            </div>
        </header>

        <!-- 1.5. åœºæ™¯é€‰æ‹©åŒºåŸŸ (é»˜è®¤éšè—) -->
        <section id="scene-selection" class="p-6 border-t border-gray-100 hidden fade-in">
            <h2 class="text-xl font-bold text-gray-800 text-center mb-5">åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ï¼Ÿ</h2>
            <div class="flex justify-around">
                <button class="scene-btn p-3 rounded-full transition-all duration-300 focus:outline-none text-center" data-scene="home">
                    <span class="text-3xl">ğŸ </span>
                    <span class="block text-xs mt-1">å±…å®¶</span>
                </button>
                <button class="scene-btn p-3 rounded-full transition-all duration-300 focus:outline-none text-center" data-scene="work">
                    <span class="text-3xl">ğŸ’¼</span>
                    <span class="block text-xs mt-1">åŠå…¬</span>
                </button>
                <button class="scene-btn p-3 rounded-full transition-all duration-300 focus:outline-none text-center" data-scene="social">
                    <span class="text-3xl">ğŸš¶â€â™€ï¸</span>
                    <span class="block text-xs mt-1">å¤–å‡º</span>
                </button>
            </div>
        </section>


        <!-- 2. é¦™å‘³å±•ç¤ºå¡ç‰‡ (åŠ¨æ€å†…å®¹) -->
        <main id="fragrance-display" class="px-6 py-4 min-h-[300px]">
            <!-- åˆå§‹æç¤º -->
            <div id="initial-prompt" class="flex items-center justify-center h-full text-gray-400">
                <p>è¯·é€‰æ‹©ä¸€ä¸ªå¿ƒæƒ…æ¥å‘ç°é¦™æ°›</p>
            </div>
            
            <!-- é¦™å‘³å¡ç‰‡ (é»˜è®¤éšè—) -->
            <div id="scent-card" class="hidden fade-in">
                <!-- é¢œè‰²å—/å›¾ç‰‡åŒº -->
                <div id="scent-color-block" class="h-32 rounded-2xl mb-4 transition-colors duration-500 flex items-center justify-center text-white text-lg font-bold">
                    <!-- å›¾ç‰‡å ä½ç¬¦, ä¹Ÿå¯ä»¥ç”¨èƒŒæ™¯å›¾ -->
                </div>
                
                <!-- è¯¦æƒ… -->
                <div class="flex justify-between items-start mb-2">
                    <h2 id="scent-name" class="text-3xl font-bold text-gray-900"></h2>
                    <!-- æ”¶è—æŒ‰é’® -->
                    <button id="favorite-btn" class="p-2 rounded-full text-gray-400 hover:text-red-500 transition-colors">
                        <ion-icon name="heart-outline" class="text-3xl"></ion-icon>
                    </button>
                </div>
                <p id="scent-description" class="text-gray-600 mb-4"></p>
                
                <!-- åˆ‡æ¢æŒ‰é’® -->
                <button id="random-btn" class="w-full py-3 px-4 bg-gray-100 text-gray-700 font-semibold rounded-lg hover:bg-gray-200 transition-colors">
                    æ¢ä¸€ä¸ªæ¨è
                </button>

                <!-- æ— æ¨èæ—¶çš„æç¤º -->
                <div id="no-recommendation" class="hidden text-center text-gray-500 py-10">
                    <p>æŠ±æ­‰ï¼Œåœ¨è¯¥åœºæ™¯ä¸‹æš‚æ—¶æ²¡æœ‰åˆé€‚çš„æ¨èã€‚</p>
                    <p class="text-sm">è¯•è¯•å…¶ä»–åœºæ™¯å§ï¼</p>
                </div>
            </div>
        </main>

        <!-- 3. æ§åˆ¶åŒºåŸŸ (ç•ªèŒ„æ—¶é’Ÿ) -->
        <section id="controls" class="px-6 py-5 bg-gray-50 border-t border-gray-100 hidden">
            <!-- ... (ç•ªèŒ„æ—¶é’Ÿä»£ç ä¸ä¹‹å‰ç›¸åŒ) ... -->
            <div class="w-full">
                <label class="block text-sm font-medium text-gray-700 mb-3 text-center">ç•ªèŒ„æ—¶é’Ÿ</label>
                <div class="flex justify-center space-x-2 mb-3">
                    <button id="pomo-mode-focus" class="pomodoro-mode-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-indigo-500 text-white" data-time="25">
                        ä¸“æ³¨ (25m)
                    </button>
                    <button id="pomo-mode-break" class="pomodoro-mode-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-gray-200 text-gray-700" data-time="5">
                        ä¼‘æ¯ (5m)
                    </button>
                </div>
                <div id="pomodoro-timer" class="text-5xl font-bold text-center text-indigo-600 my-4 tracking-wider">
                    25:00
                </div>
                <div class="flex justify-center space-x-3">
                    <button id="pomodoro-start" class="px-6 py-2 bg-indigo-500 text-white rounded-lg shadow hover:bg-indigo-600 transition-colors font-semibold">
                        å¼€å§‹ä¸“æ³¨
                    </button>
                    <button id="pomodoro-pause" class="px-6 py-2 bg-yellow-500 text-white rounded-lg shadow hover:bg-yellow-600 transition-colors font-semibold hidden">
                        æš‚åœ
                    </button>
                    <button id="pomodoro-reset" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors font-semibold">
                        é‡ç½®
                    </button>
                </div>
            </div>
        </section>

        <!-- 4. ä½¿ç”¨å»ºè®®åŒºåŸŸ (é»˜è®¤éšè—) -->
        <section id="usage-tips" class="px-6 py-5 bg-indigo-50 border-t border-indigo-100 hidden">
            
            <!-- æ–°å¢ï¼šé¢œè‰²æ­é… -->
            <div id="color-recommendation-box" class="mb-4 p-3 rounded-lg flex items-center transition-colors duration-300">
                <div id="color-recommendation-swatch" class="w-10 h-10 rounded-full mr-3 border border-gray-200 shadow-sm"></div>
                <div>
                    <h4 class="font-semibold text-indigo-800">ä»Šæ—¥è½¬è¿è‰²</h4>
                    <p id="color-recommendation-name" class="text-sm text-indigo-700 font-medium"></p>
                </div>
            </div>
            <p id="color-recommendation-desc" class="text-sm text-indigo-700 mb-4"></p>

            <!-- åŸæœ‰å†…å®¹ -->
            <div class="mb-3">
                <h4 class="font-semibold text-indigo-800">ä½¿ç”¨åœºæ™¯</h4>
                <p id="scent-scene" class="text-sm text-indigo-700"></p>
            </div>
            <div class="mb-3">
                <h4 class="font-semibold text-indigo-800">æ¨èé…æ–¹ (Top Notes)</h4>
                <p id="scent-recipe" class="text-sm text-indigo-700"></p>
            </div>
            <div class="mb-3">
                <h4 class="font-semibold text-indigo-800">éŸ³ä¹æ­é…</h4>
                <p id="scent-music" class="text-sm text-indigo-700"></p>
            </div>
            <div>
                <h4 class="font-semibold text-indigo-800">å†¥æƒ³å»ºè®®</h4>
                <p id="scent-meditation" class="text-sm text-indigo-700"></p>
            </div>
        </section>


        <!-- 5. åº•éƒ¨å¯¼èˆª (åˆ†äº«ä¸æ”¶è—åˆ—è¡¨) -->
        <footer class="flex justify-around p-4 border-t border-gray-200 bg-white">
             <!-- ... (åº•éƒ¨å¯¼èˆªä¸ä¹‹å‰ç›¸åŒ) ... -->
            <button id="share-btn" class="flex flex-col items-center text-gray-600 hover:text-indigo-500 transition-colors">
                <ion-icon name="share-social-outline" class="text-2xl"></ion-icon>
                <span class="text-xs">åˆ†äº«</span>
            </button>
            <button id="show-favorites-btn" class="flex flex-col items-center text-gray-600 hover:text-indigo-500 transition-colors">
                <ion-icon name="bookmark-outline" class="text-2xl"></ion-icon>
                <span class="text-xs">æˆ‘çš„æ”¶è—</span>
            </button>
        </footer>
    </div>


    <!-- å¼¹çª—ï¼šé€šç”¨æé†’ -->
    <div id="alert-modal" class="fixed inset-0 z-50 modal-backdrop items-center justify-center p-4 hidden">
        <!-- ... (å¼¹çª—ä¸ä¹‹å‰ç›¸åŒ) ... -->
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full text-center">
            <h3 id="alert-modal-title" class="text-xl font-bold mb-4">æ—¶é—´åˆ°ï¼</h3>
            <p id="alert-modal-message" class="text-gray-600 mb-6">æ‚¨çš„é¦™æ°›æ—¶é—´å·²ç»“æŸã€‚</p>
            <button id="close-alert-modal" class="w-full py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors">
                å…³é—­
            </button>
        </div>
    </div>

    <!-- å¼¹çª—ï¼šæˆ‘çš„æ”¶è— -->
    <div id="favorites-modal" class="fixed inset-0 z-50 modal-backdrop items-center justify-center p-4 hidden">
        <!-- ... (å¼¹çª—ä¸ä¹‹å‰ç›¸åŒ) ... -->
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">æˆ‘çš„æ”¶è—</h3>
                <button id="close-favorites-modal" class="text-gray-400 hover:text-gray-600">
                    <ion-icon name="close-outline" class="text-2xl"></ion-icon>
                </button>
            </div>
            <div id="favorites-list" class="overflow-y-auto space-y-3">
                <!-- æ”¶è—å†…å®¹å°†åŠ¨æ€æ’å…¥è¿™é‡Œ -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- 1. é™æ€æ•°æ® (é‡æ„) ---
            const scentData = {
                "happy": {
                    "color_recommendation": {
                        "name": "æ´»åŠ›é»„",
                        "hex": "#FDE047", // yellow-400
                        "description": "æ˜äº®çš„é»„è‰²èƒ½æ¿€å‘æ„‰æ‚¦æ„Ÿã€‚è¯•è¯•é»„è‰²çš„ä¾¿ç­¾ã€æ¯å­æˆ–ä¸€ä»¶Tæ¤ã€‚"
                    },
                    "scents": [
                        { "name": "é˜³å…‰ç”œæ©™", "short_description": "æ˜äº®ã€æ„‰æ‚¦çš„æŸ‘æ©˜é¦™è°ƒã€‚", "top_notes": "ç”œæ©™, ä½›æ‰‹æŸ‘", "recipe": "ç”œæ©™3æ»´ + ä½›æ‰‹æŸ‘2æ»´", "color_hex": "#FDBA74", "music_tag": "è½»å¿«æµè¡Œä¹", "scene": "æ—©æ™¨èµ·åºŠæç¥ï¼Œæˆ–æœ‹å‹èšä¼šã€‚", "meditation": "æƒ³è±¡æ¸©æš–çš„é˜³å…‰æ´’æ»¡å…¨èº«ã€‚", "scene_tags": ["home", "social"] },
                        { "name": "è‘¡è„æŸšæ´»åŠ›", "short_description": "æ¸…æ–°å¾®è‹¦çš„æœé¦™ï¼ŒæŒ¯å¥‹ç²¾ç¥ã€‚", "top_notes": "è‘¡è„æŸš, æœæ¾å­", "recipe": "è‘¡è„æŸš4æ»´ + æœæ¾å­1æ»´", "color_hex": "#F87171", "music_tag": "ç‹¬ç«‹æ‘‡æ»š", "scene": "æ„Ÿåˆ°ç–²å€¦æˆ–ç¼ºä¹åŠ¨åŠ›æ—¶ä½¿ç”¨ã€‚", "meditation": "ä¸“æ³¨äºé¦™æ°”ä¸­çš„å¾®è‹¦ä¸æ¸…æ–°ã€‚", "scene_tags": ["home", "work"] },
                        { "name": "èŒ‰è‰æ¬£å–œ", "short_description": "ç”œç¾çš„èŠ±é¦™ï¼Œå¸¦æ¥å¹¸ç¦æ„Ÿã€‚", "top_notes": "èŒ‰è‰, ä¾å…°", "recipe": "èŒ‰è‰1æ»´ + ä¾å…°2æ»´", "color_hex": "#FBCFE8", "music_tag": "æµªæ¼«å¼¦ä¹", "scene": "ç‰¹æ®Šåœºåˆã€çº¦ä¼šå‰ã€‚", "meditation": "æƒ³è±¡è‡ªå·±å¦‚èŒ‰è‰èŠ±ç“£èˆ¬ç»½æ”¾ã€‚", "scene_tags": ["social"] }
                    ]
                },
                "relaxed": {
                    "color_recommendation": {
                        "name": "æ²»æ„ˆç»¿",
                        "hex": "#86EFAC", // green-300
                        "description": "è‡ªç„¶çš„ç»¿è‰²å¸®åŠ©èº«å¿ƒæ”¾æ¾ã€‚åœ¨æ¡Œä¸Šæ”¾ä¸€ç›†å°æ¤ç‰©ï¼Œæˆ–çœ‹çœ‹çª—å¤–çš„æ ‘ã€‚"
                    },
                    "scents": [
                        { "name": "è–°è¡£è‰èˆ’ç¼“è°ƒ", "short_description": "ç»å…¸çš„èŠ±è‰é¦™ï¼Œå¸¦æ¥æ·±åº¦æ”¾æ¾ã€‚", "top_notes": "é«˜åœ°è–°è¡£è‰, ç½—é©¬æ´‹ç”˜èŠ", "recipe": "è–°è¡£è‰3æ»´ + ç½—æ´‹1æ»´", "color_hex": "#C4B5FD", "music_tag": "è½»éŸ³ä¹", "scene": "ç¡å‰é˜…è¯»ã€æ³¡æ¾¡æˆ–å†¥æƒ³æ—¶ã€‚", "meditation": "æƒ³è±¡è‡ªå·±èººåœ¨ç´«è‰²çš„è–°è¡£è‰èŠ±æµ·ã€‚", "scene_tags": ["home"] },
                        { "name": "ä¹³é¦™å®é™", "short_description": "æ¸©æš–ã€æ·±æ²‰çš„æ ‘è„‚é¦™æ°”ã€‚", "top_notes": "ä¹³é¦™, å¿«ä¹é¼ å°¾è‰", "recipe": "ä¹³é¦™2æ»´ + å¿«ä¹é¼ å°¾è‰2æ»´", "color_hex": "#FDE68A", "music_tag": "å†¥æƒ³é¢‚é’µ", "scene": "ç‘œä¼½ç»ƒä¹ æˆ–éœ€è¦ä»ç¹å¿™ä¸­æŠ½ç¦»æ—¶ã€‚", "meditation": "è·Ÿéšé¦™æ°”è¿›è¡Œæ·±é•¿çš„è…¹å¼å‘¼å¸ã€‚", "scene_tags": ["home", "work"] },
                        { "name": "ä½›æ‰‹æŸ‘æ‚ ç„¶", "short_description": "å¸¦æœ‰èŠ±é¦™çš„æŸ‘æ©˜è°ƒï¼Œæ”¾æ¾æƒ…ç»ªã€‚", "top_notes": "ä½›æ‰‹æŸ‘, æ©™èŠ±", "recipe": "ä½›æ‰‹æŸ‘3æ»´ + æ©™èŠ±1æ»´", "color_hex": "#BEF264", "music_tag": "Lofi Chillhop", "scene": "ä¸‹åˆèŒ¶æ—¶é—´ï¼Œæˆ–æ„Ÿè§‰æƒ…ç»ªç´§ç»·æ—¶ã€‚", "meditation": "æ¥çº³è‡ªå·±æƒ…ç»ªçš„æµåŠ¨ã€‚", "scene_tags": ["home", "social"] }
                    ]
                },
                "focused": {
                    "color_recommendation": {
                        "name": "ä¸“æ³¨è“",
                        "hex": "#93C5FD", // blue-300
                        "description": "å†·é™çš„è“è‰²æœ‰åŠ©äºé›†ä¸­æ³¨æ„åŠ›ã€‚ä½¿ç”¨è“è‰²çš„ç¬”æˆ–ç¬”è®°æœ¬èƒŒæ™¯ã€‚"
                    },
                    "scents": [
                        { "name": "è¿·è¿­é¦™è–„è·", "short_description": "æ¸…å‡‰ã€ç©¿é€åŠ›å¼ºçš„è‰æœ¬é¦™æ°”ã€‚", "top_notes": "è¿·è¿­é¦™, æ¬§è–„è·", "recipe": "è¿·è¿­é¦™2æ»´ + æ¬§è–„è·1æ»´", "color_hex": "#A5F3FC", "music_tag": "å¤å…¸é’¢ç´", "scene": "é•¿æ—¶é—´å·¥ä½œã€å­¦ä¹ æ—¶ã€‚", "meditation": "æƒ³è±¡æ¸…å‡‰çš„é¦™æ°”ç©¿é€è¿·é›¾ã€‚", "scene_tags": ["work"] },
                        { "name": "é›ªæ¾ä¸“æ³¨", "short_description": "æ²‰ç¨³çš„æœ¨è´¨é¦™ï¼Œå¸¦æ¥å®‰å®šçš„åŠ›é‡ã€‚", "top_notes": "å¤§è¥¿æ´‹é›ªæ¾, ä¸æŸ", "recipe": "é›ªæ¾3æ»´ + ä¸æŸ2æ»´", "color_hex": "#A8A29E", "music_tag": "Lofi Hip Hop", "scene": "å¤„ç†å¤æ‚ä»»åŠ¡æˆ–éœ€è¦åˆ›æ„å†™ä½œæ—¶ã€‚", "meditation": "æƒ³è±¡è‡ªå·±æ‰æ ¹äºå¤§åœ°ã€‚", "scene_tags": ["work", "home"] },
                        { "name": "æŸ æª¬æ€è€ƒ", "short_description": "æ¸…æ–°çš„æŸ æª¬é¦™æ°”ï¼Œæ¿€æ´»é€»è¾‘æ€ç»´ã€‚", "top_notes": "æŸ æª¬, ç½—å‹’", "recipe": "æŸ æª¬3æ»´ + ç½—å‹’1æ»´", "color_hex": "#FEF08A", "music_tag": "å·´æ´›å…‹éŸ³ä¹", "scene": "å¤´è„‘é£æš´ã€è§£é¢˜æ—¶ã€‚", "meditation": "å¸æ°”æ—¶ï¼Œæ„Ÿå—æ¸…æ˜ã€‚", "scene_tags": ["work"] }
                    ]
                },
                "sleepy": {
                    "color_recommendation": {
                        "name": "é™è°§ç´«",
                        "hex": "#C4B5FD", // violet-300
                        "description": "æŸ”å’Œçš„ç´«è‰²ä¸é›è“è‰²æœ‰åŠ©äºå¹³é™ã€‚æ¢ä¸Šç´«è‰²çš„åºŠå•æˆ–ç¡è¡£ã€‚"
                    },
                    "scents": [
                        { "name": "é™è°§ä¹‹å¤œ", "short_description": "æ´‹ç”˜èŠä¸æª€é¦™çš„ç»“åˆï¼Œæ¸©æŸ”åŠ©çœ ã€‚", "top_notes": "ç½—æ´‹, æª€é¦™, è–°è¡£è‰", "recipe": "ç½—æ´‹1æ»´ + æª€é¦™2æ»´ + è–°è¡£è‰2æ»´", "color_hex": "#A5B4FC", "music_tag": "æ‘‡ç¯®æ›²", "scene": "ç¡å‰åŠå°æ—¶ä½¿ç”¨ã€‚", "meditation": "æƒ³è±¡èº«ä½“é€ä¸€æ”¾æ¾ã€æ²‰å…¥åºŠå«ã€‚", "scene_tags": ["home"] },
                        { "name": "é©¬éƒå…°ç”œæ¢¦", "short_description": "æ¸©æš–çš„è‰æœ¬é¦™æ°”ï¼Œå®‰æŠšæ€è™‘ã€‚", "top_notes": "ç”œé©¬éƒå…°, ä½›æ‰‹æŸ‘", "recipe": "ç”œé©¬éƒå…°3æ»´ + ä½›æ‰‹æŸ‘1æ»´", "color_hex": "#FCA5A5", "music_tag": "èˆ’ç¼“çˆµå£«", "scene": "å› å‹åŠ›æˆ–ç„¦è™‘éš¾ä»¥å…¥ç¡æ—¶ã€‚", "meditation": "æ„Ÿå—æ¸©æš–çš„é¦™æ°”åŒ…è£¹ç€ä½ ã€‚", "scene_tags": ["home"] }
                    ]
                },
                "dejected": {
                    "color_recommendation": {
                        "name": "å¸Œæœ›æ©™",
                        "hex": "#FDBA74", // orange-300
                        "description": "æ¸©æš–çš„æ©™è‰²èƒ½å¸¦æ¥å®‰æ…°å’Œç§¯ææ„Ÿã€‚ç‚¹ä¸€ä¸ªæ©™è‰²çš„èœ¡çƒ›æˆ–ç©¿ä¸Šæ©™è‰²è¢œå­ã€‚"
                    },
                    "scents": [
                        { "name": "ä½›æ‰‹æŸ‘æ…°è—‰", "short_description": "æŠ—æŠ‘éƒçš„é¦–é€‰ï¼Œå¸¦æ¥é˜³å…‰æ„Ÿã€‚", "top_notes": "ä½›æ‰‹æŸ‘, ç”œæ©™", "recipe": "ä½›æ‰‹æŸ‘3æ»´ + ç”œæ©™2æ»´", "color_hex": "#BEF264", "music_tag": "è½»æŸ”æ°‘è°£", "scene": "æƒ…ç»ªä½è½ï¼Œæä¸èµ·åŠ²æ—¶ã€‚", "meditation": "æƒ³è±¡ä¸€ç¼•é˜³å…‰ç…§è¿›å¿ƒä¸­ã€‚", "scene_tags": ["home", "social"] },
                        { "name": "ä¹³é¦™å®ˆæŠ¤", "short_description": "æ·±æ²‰çš„é¦™æ°”ï¼Œå¸¦æ¥è¢«ä¿æŠ¤çš„å®‰å…¨æ„Ÿã€‚", "top_notes": "ä¹³é¦™, çœŸæ­£è–°è¡£è‰", "recipe": "ä¹³é¦™2æ»´ + è–°è¡£è‰2æ»´", "color_hex": "#FDE68A", "music_tag": "åœ£å’", "scene": "æ„Ÿè§‰å­¤ç‹¬æˆ–éœ€è¦æ”¯æŒæ—¶ã€‚", "meditation": "æ„Ÿå—è‡ªå·±è¢«ä¸€ä¸ªæ¸©æš–çš„å…‰ç½©åŒ…è£¹ã€‚", "scene_tags": ["home", "work"] }
                    ]
                },
                "angry": {
                    "color_recommendation": {
                        "name": "å¹³å’Œç²‰",
                        "hex": "#FBCFE8", // pink-200
                        "description": "æŸ”å’Œçš„ç²‰è‰²æœ‰åŠ©äºç†„ç­æ€’ç«ï¼Œå¸¦æ¥æ¸©æŸ”ã€‚ä½¿ç”¨ç²‰è‰²çš„æ¯å«æˆ–æ¯›å·¾ã€‚"
                    },
                    "scents": [
                        { "name": "ä¾å…°é™ç«", "short_description": "å¼ºæ•ˆçš„é•‡é™èŠ±é¦™ï¼Œè¿…é€Ÿç¼“è§£æ„¤æ€’ã€‚", "top_notes": "ä¾å…°, ä½›æ‰‹æŸ‘", "recipe": "ä¾å…°1æ»´ + ä½›æ‰‹æŸ‘3æ»´", "color_hex": "#FBCFE8", "music_tag": "èˆ’ç¼“æµ·æµªå£°", "scene": "æ„Ÿåˆ°çƒ¦èºã€å³å°†å‘ç«æ—¶ã€‚", "meditation": "æ·±å‘¼å¸ï¼Œæƒ³è±¡æ€’ç«éšå‘¼æ°”æ’å‡ºã€‚", "scene_tags": ["home", "work"] },
                        { "name": "å²©å…°è‰æ‰æ ¹", "short_description": "æ·±æ²‰çš„æ³¥åœŸæ°”æ¯ï¼Œè®©æ€ç»ªå¹³ç¨³è½åœ°ã€‚", "top_notes": "å²©å…°è‰, é›ªæ¾", "recipe": "å²©å…°è‰1æ»´ + é›ªæ¾2æ»´", "color_hex": "#A1A1AA", "music_tag": "å¤§åœ°é¼“ä¹", "scene": "æ€’ç«è¿‡åï¼Œæ„Ÿåˆ°å¿ƒç¥ä¸å®æ—¶ã€‚", "meditation": "æƒ³è±¡åŒè„šæ·±æ·±æ‰æ ¹äºåœŸåœ°ã€‚", "scene_tags": ["home", "work"] }
                    ]
                }
            };


            // --- 2. çŠ¶æ€å˜é‡ ---
            let currentMood = null;
            let currentScene = null; // æ–°å¢
            let currentScent = null;
            let favorites = [];
            
            // (ç•ªèŒ„æ—¶é’ŸçŠ¶æ€å˜é‡)
            let pomoTimerId = null;
            let pomoSecondsRemaining = 25 * 60;
            let pomoIsRunning = false;
            let pomoCurrentMode = 25; 
            let lastTickTime = 0;

            // --- 3. DOM å…ƒç´ å¼•ç”¨ ---
            const moodButtons = document.querySelectorAll('.mood-btn');
            
            // (åœºæ™¯)
            const sceneSelectionSection = document.getElementById('scene-selection');
            const sceneButtons = document.querySelectorAll('.scene-btn');
            
            const display = document.getElementById('fragrance-display');
            const initialPrompt = document.getElementById('initial-prompt');
            const scentCard = document.getElementById('scent-card');
            const colorBlock = document.getElementById('scent-color-block');
            const scentName = document.getElementById('scent-name');
            const scentDescription = document.getElementById('scent-description');
            const favoriteBtn = document.getElementById('favorite-btn');
            const randomBtn = document.getElementById('random-btn');
            const noRecommendation = document.getElementById('no-recommendation');
            
            const controlsSection = document.getElementById('controls');
            // (ç•ªèŒ„æ—¶é’Ÿ DOM)
            const pomoTimerDisplay = document.getElementById('pomodoro-timer');
            const pomoStartBtn = document.getElementById('pomodoro-start');
            const pomoPauseBtn = document.getElementById('pomodoro-pause');
            const pomoResetBtn = document.getElementById('pomodoro-reset');
            const pomoModeFocusBtn = document.getElementById('pomo-mode-focus');
            const pomoModeBreakBtn = document.getElementById('pomo-mode-break');
            
            const usageTipsSection = document.getElementById('usage-tips');
            // (é¢œè‰²æ­é… DOM)
            const colorBox = document.getElementById('color-recommendation-box');
            const colorSwatch = document.getElementById('color-recommendation-swatch');
            const colorName = document.getElementById('color-recommendation-name');
            const colorDesc = document.getElementById('color-recommendation-desc');
            // (å…¶ä»–å»ºè®® DOM)
            const scentScene = document.getElementById('scent-scene');
            const scentRecipe = document.getElementById('scent-recipe');
            const scentMusic = document.getElementById('scent-music');
            const scentMeditation = document.getElementById('scent-meditation');

            const shareBtn = document.getElementById('share-btn');
            const showFavoritesBtn = document.getElementById('show-favorites-btn');
            
            // (å¼¹çª— DOM)
            const alertModal = document.getElementById('alert-modal');
            const alertModalTitle = document.getElementById('alert-modal-title');
            const alertModalMessage = document.getElementById('alert-modal-message');
            const closeAlertModal = document.getElementById('close-alert-modal');
            const favoritesModal = document.getElementById('favorites-modal');
            const favoritesList = document.getElementById('favorites-list');
            const closeFavoritesModal = document.getElementById('close-favorites-modal');

            // --- 4. æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ---

            function init() {
                loadFavorites();
                addEventListeners();
                updatePomodoroDisplay(); 
            }

            function addEventListeners() {
                moodButtons.forEach(btn => {
                    btn.addEventListener('click', () => handleMoodSelect(btn.dataset.mood));
                });

                // (æ–°å¢åœºæ™¯ç›‘å¬)
                sceneButtons.forEach(btn => {
                    btn.addEventListener('click', () => handleSceneSelect(btn.dataset.scene));
                });

                randomBtn.addEventListener('click', () => displayRecommendation(true));
                favoriteBtn.addEventListener('click', toggleFavorite);
                
                // (ç•ªèŒ„æ—¶é’Ÿç›‘å¬)
                pomoStartBtn.addEventListener('click', startPomodoro);
                pomoPauseBtn.addEventListener('click', pausePomodoro);
                pomoResetBtn.addEventListener('click', resetPomodoro);
                pomoModeFocusBtn.addEventListener('click', () => selectPomodoroMode(25));
                pomoModeBreakBtn.addEventListener('click', () => selectPomodoroMode(5));
                
                shareBtn.addEventListener('click', shareScent);
                showFavoritesBtn.addEventListener('click', showFavoritesModal);
                
                closeAlertModal.addEventListener('click', () => alertModal.classList.add('hidden'));
                closeFavoritesModal.addEventListener('click', () => favoritesModal.classList.add('hidden'));
            }

            /**
             * æ­¥éª¤ 1: å¤„ç†å¿ƒæƒ…é€‰æ‹©
             */
            function handleMoodSelect(mood) {
                currentMood = mood;
                currentScene = null; // é‡ç½®åœºæ™¯
                
                // æ›´æ–°å¿ƒæƒ…æŒ‰é’®æ¿€æ´»çŠ¶æ€
                moodButtons.forEach(btn => {
                    btn.classList.remove('bg-indigo-100', 'scale-110');
                    if (btn.dataset.mood === mood) {
                        btn.classList.add('bg-indigo-100', 'scale-110');
                    }
                });

                // é‡ç½®åœºæ™¯æŒ‰é’®çŠ¶æ€
                sceneButtons.forEach(btn => {
                    btn.classList.remove('bg-indigo-100', 'scale-110');
                });
                
                // æ˜¾ç¤ºåœºæ™¯é€‰æ‹©å™¨
                sceneSelectionSection.classList.remove('hidden');

                // éšè—æ—§çš„æ¨è
                scentCard.classList.add('hidden');
                controlsSection.classList.add('hidden');
                usageTipsSection.classList.add('hidden');
                
                // æ›´æ–°æç¤º
                initialPrompt.classList.remove('hidden');
                initialPrompt.textContent = "è¯·é€‰æ‹©ä¸€ä¸ªåœºæ™¯";
            }

            /**
             * æ­¥éª¤ 2: å¤„ç†åœºæ™¯é€‰æ‹©
             */
            function handleSceneSelect(scene) {
                currentScene = scene;

                // æ›´æ–°åœºæ™¯æŒ‰é’®æ¿€æ´»çŠ¶æ€
                sceneButtons.forEach(btn => {
                    btn.classList.remove('bg-indigo-100', 'scale-110');
                    if (btn.dataset.scene === scene) {
                        btn.classList.add('bg-indigo-100', 'scale-110');
                    }
                });

                // æ˜¾ç¤ºç¬¬ä¸€ä¸ªæ¨è
                displayRecommendation(false);
            }


            /**
             * æ­¥éª¤ 3: æ˜¾ç¤ºæ¨è (åŸºäºå¿ƒæƒ… + åœºæ™¯)
             * @param {boolean} isRandom - æ˜¯å¦éšæœºé€‰æ‹©
             */
            function displayRecommendation(isRandom = false) {
                if (!currentMood || !currentScene) return;

                const moodData = scentData[currentMood];
                const availableScents = moodData.scents.filter(s => s.scene_tags.includes(currentScene));

                // éšè—åˆå§‹æç¤º, æ˜¾ç¤ºå¡ç‰‡
                initialPrompt.classList.add('hidden');
                scentCard.classList.remove('hidden');
                scentCard.classList.remove('fade-in'); 
                void scentCard.offsetWidth; 
                scentCard.classList.add('fade-in'); 

                if (availableScents.length === 0) {
                    // æ²¡æœ‰åŒ¹é…çš„é¦™æ°›
                    noRecommendation.classList.remove('hidden');
                    // éšè—é¦™æ°›è¯¦æƒ…å’Œæ§åˆ¶
                    document.getElementById('scent-color-block').classList.add('hidden');
                    document.getElementById('scent-name').classList.add('hidden');
                    document.getElementById('scent-description').classList.add('hidden');
                    document.getElementById('favorite-btn').classList.add('hidden');
                    document.getElementById('random-btn').classList.add('hidden');
                    controlsSection.classList.add('hidden');
                    usageTipsSection.classList.add('hidden');
                    currentScent = null;
                    return;
                }
                
                // æ¢å¤æ˜¾ç¤º
                noRecommendation.classList.add('hidden');
                document.getElementById('scent-color-block').classList.remove('hidden');
                document.getElementById('scent-name').classList.remove('hidden');
                document.getElementById('scent-description').classList.remove('hidden');
                document.getElementById('favorite-btn').classList.remove('hidden');
                document.getElementById('random-btn').classList.remove('hidden');

                // é€‰æ‹©é¦™æ°›
                let scent;
                if (isRandom) {
                    const otherScents = availableScents.filter(s => s.name !== currentScent?.name);
                    if (otherScents.length > 0) {
                        scent = otherScents[Math.floor(Math.random() * otherScents.length)];
                    } else {
                        scent = availableScents[0];
                    }
                } else {
                    scent = availableScents[0];
                }
                
                currentScent = scent;

                // 1. æ›´æ–°é¦™æ°›å¡ç‰‡
                colorBlock.style.backgroundColor = scent.color_hex;
                colorBlock.textContent = scent.top_notes; 
                scentName.textContent = scent.name;
                scentDescription.textContent = scent.short_description;
                updateFavoriteButtonState();

                // 2. æ›´æ–°é¢œè‰²å»ºè®®
                const color = moodData.color_recommendation;
                colorSwatch.style.backgroundColor = color.hex;
                colorName.textContent = color.name;
                colorDesc.textContent = color.description;
                // ä½¿ç”¨ Tailwind çš„é€æ˜åº¦ç®€å†™ (ä¾‹å¦‚ #FDE047 + 20% é€æ˜åº¦)
                // æ³¨æ„: style å±æ€§ä¸æ”¯æŒ Tailwind çš„ /opacity, å¿…é¡»ç”¨ RGBA æˆ– 8ä½Hex
                // ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå›ºå®šçš„æµ…è‰²èƒŒæ™¯
                colorBox.style.backgroundColor = `${color.hex}33`; // å¢åŠ èƒŒæ™¯è‰²
                
                // 3. æ›´æ–°ä½¿ç”¨å»ºè®®
                scentScene.textContent = scent.scene;
                scentRecipe.textContent = scent.recipe;
                scentMusic.textContent = scent.music_tag;
                scentMeditation.textContent = scent.meditation;
                
                // 4. æ˜¾ç¤ºæ§åˆ¶å’Œå»ºè®®åŒºåŸŸ
                controlsSection.classList.remove('hidden');
                usageTipsSection.classList.remove('hidden');
            }


            // --- 5. ç•ªèŒ„æ—¶é’ŸåŠŸèƒ½ (ä¸ä¹‹å‰ç›¸åŒ) ---
            
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            function updatePomodoroDisplay() {
                pomoTimerDisplay.textContent = formatTime(pomoSecondsRemaining);
            }

            function selectPomodoroMode(minutes) {
                pausePomodoro(); 
                pomoCurrentMode = minutes;
                pomoSecondsRemaining = minutes * 60;
                updatePomodoroDisplay();

                if (minutes === 25) {
                    pomoModeFocusBtn.classList.add('bg-indigo-500', 'text-white');
                    pomoModeFocusBtn.classList.remove('bg-gray-200', 'text-gray-700');
                    pomoModeBreakBtn.classList.add('bg-gray-200', 'text-gray-700');
                    pomoModeBreakBtn.classList.remove('bg-indigo-500', 'text-white');
                    pomoStartBtn.textContent = "å¼€å§‹ä¸“æ³¨";
                } else {
                    pomoModeBreakBtn.classList.add('bg-indigo-500', 'text-white');
                    pomoModeBreakBtn.classList.remove('bg-gray-200', 'text-gray-700');
                    pomoModeFocusBtn.classList.add('bg-gray-200', 'text-gray-700');
                    pomoModeFocusBtn.classList.remove('bg-indigo-500', 'text-white');
                    pomoStartBtn.textContent = "å¼€å§‹ä¼‘æ¯";
                }
            }

            function startPomodoro() {
                pomoIsRunning = true;
                pomoStartBtn.classList.add('hidden');
                pomoPauseBtn.classList.remove('hidden');
                lastTickTime = Date.now();
                pomoTimerId = setInterval(tick, 1000);
            }

            function pausePomodoro() {
                pomoIsRunning = false;
                pomoStartBtn.classList.remove('hidden');
                pomoPauseBtn.classList.add('hidden');
                if (pomoTimerId) {
                    clearInterval(pomoTimerId);
                    pomoTimerId = null;
                }
            }
            
            function resetPomodoro() {
                pausePomodoro();
                pomoSecondsRemaining = pomoCurrentMode * 60;
                updatePomodoroDisplay();
                pomoStartBtn.textContent = (pomoCurrentMode === 25) ? "å¼€å§‹ä¸“æ³¨" : "å¼€å§‹ä¼‘æ¯";
            }

            function tick() {
                const now = Date.now();
                const elapsed = Math.round((now - lastTickTime) / 1000);
                lastTickTime = now;
                
                pomoSecondsRemaining -= elapsed;
                
                if (pomoSecondsRemaining <= 0) {
                    pomoSecondsRemaining = 0;
                    updatePomodoroDisplay();
                    pausePomodoro();
                    if (pomoCurrentMode === 25) {
                        showAppAlert("æ—¶é—´åˆ°ï¼", "ä¸“æ³¨æ—¶é—´å·²ç»“æŸï¼Œä¼‘æ¯5åˆ†é’Ÿå§ï¼");
                        selectPomodoroMode(5);
                    } else {
                        showAppAlert("æ—¶é—´åˆ°ï¼", "ä¼‘æ¯å·²ç»“æŸï¼Œå¼€å§‹æ–°çš„ä¸“æ³¨å§ï¼");
                        selectPomodoroMode(25);
                    }
                } else {
                    updatePomodoroDisplay();
                }
            }
            
            function showAppAlert(title, message) {
                alertModalTitle.textContent = title;
                alertModalMessage.textContent = message;
                alertModal.classList.remove('hidden');
                alertModal.classList.add('flex');
            }


            // --- 6. æ”¶è—å¤¹ (ä¸ä¹‹å‰ç›¸åŒ) ---

            function loadFavorites() {
                favorites = JSON.parse(localStorage.getItem('moodScentFavorites')) || [];
            }

            function saveFavorites() {
                localStorage.setItem('moodScentFavorites', JSON.stringify(favorites));
            }

            function toggleFavorite() {
                if (!currentScent) return;
                const index = favorites.findIndex(fav => fav.name === currentScent.name);
                if (index > -1) {
                    favorites.splice(index, 1);
                } else {
                    favorites.push(currentScent);
                }
                saveFavorites();
                updateFavoriteButtonState();
            }

            function updateFavoriteButtonState() {
                if (!currentScent) return;
                const isFavorited = favorites.some(fav => fav.name === currentScent.name);
                const icon = favoriteBtn.querySelector('ion-icon');
                if (isFavorited) {
                    icon.setAttribute('name', 'heart');
                    favoriteBtn.classList.add('text-red-500');
                    icon.classList.add('scale-110');
                } else {
                    icon.setAttribute('name', 'heart-outline');
                    favoriteBtn.classList.remove('text-red-500');
                    icon.classList.remove('scale-110');
                }
            }

            function showFavoritesModal() {
                favoritesList.innerHTML = ''; 
                if (favorites.length === 0) {
                    favoritesList.innerHTML = '<p class="text-gray-500 text-center">æš‚æ— æ”¶è—</p>';
                } else {
                    favorites.forEach(scent => {
                        const item = document.createElement('div');
                        item.className = 'flex items-center p-3 bg-gray-50 rounded-lg';
                        item.innerHTML = `
                            <div class="w-10 h-10 rounded-full mr-3" style="background-color: ${scent.color_hex};"></div>
                            <div>
                                <p class="font-semibold text-gray-800">${scent.name}</p>
                                <p class="text-sm text-gray-500">${scent.short_description}</p>
                            </div>
                        `;
                        favoritesList.appendChild(item);
                    });
                }
                favoritesModal.classList.remove('hidden');
                favoritesModal.classList.add('flex');
            }

            // --- 7. åˆ†äº«åŠŸèƒ½ (æ›´æ–°åˆ†äº«æ–‡æ¡ˆ) ---

            async function shareScent() {
                if (!currentScent) {
                    showAppAlert("åˆ†äº«å¤±è´¥", "è¯·å…ˆé€‰æ‹©ä¸€æ¬¾é¦™æ°›å†åˆ†äº«ã€‚");
                    return;
                }

                // æ›´æ–°æ–‡æ¡ˆ
                const moodText = {
                    "happy": "å¼€å¿ƒ",
                    "relaxed": "æ”¾æ¾",
                    "focused": "ä¸“æ³¨",
                    "sleepy": "åŠ©çœ ",
                    "dejected": "æ²®ä¸§",
                    "angry": "ç”Ÿæ°”"
                }[currentMood] || "ç‰¹åˆ«";

                const shareText = `æˆ‘ç°åœ¨çš„å¿ƒæƒ…ï¼š${moodText} â€” æˆ‘é€‰æ‹©äº†ã€${currentScent.name}ã€ï¼Œ${currentScent.scene.split('ã€‚')[0]}ï¼Œå®Œç¾çš„æ—¶åˆ»ã€‚`;

                const shareData = {
                    title: 'æˆ‘çš„å¿ƒæƒ…é¦™æ°›',
                    text: shareText,
                    url: window.location.href,
                };

                if (navigator.share) {
                    try {
                        await navigator.share(shareData);
                        console.log('åˆ†äº«æˆåŠŸ');
                    } catch (err) {
                        console.error('åˆ†äº«å¤±è´¥:', err);
                    }
                } else {
                    showAppAlert("åˆ†äº«å¤±è´¥", "æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒåˆ†äº«åŠŸèƒ½ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥ã€‚");
                }
            }

            // --- 8. å¯åŠ¨åº”ç”¨ ---
            init();
        });
    </script>
</body>
</html>

